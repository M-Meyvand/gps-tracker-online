# سیستم ردیابی GPS آنلاین با SIM800L

## 🎯 توضیحات کلی
این سیستم یک ردیاب GPS پیشرفته است که موقعیت را از طریق اینترنت سیم‌کارت به سرور ارسال می‌کند و روی نقشه آنلاین نمایش می‌دهد. مسیر حرکت به صورت Real-time روی نقشه نمایش داده می‌شود.

## ✨ ویژگی‌های اصلی

### 🔄 Real-time Tracking
- ارسال موقعیت هر 30 ثانیه
- نمایش مسیر حرکت روی نقشه
- به‌روزرسانی لحظه‌ای موقعیت
- هشدار خروج از محدوده

### 📊 آمار و گزارش‌گیری
- تعداد نقاط ردیابی
- سرعت متوسط و حداکثر
- مسافت کل طی شده
- مدت زمان ردیابی

### 🚨 سیستم هشدار
- هشدار خروج از شعاع 100 متری
- نوتیفیکیشن Real-time
- ذخیره تاریخچه هشدارها

### 🗺️ نقشه تعاملی
- نقشه OpenStreetMap
- نمایش مسیر با رنگ‌بندی
- نشانگرهای شروع و پایان
- زوم و جابجایی آسان

## 🛠️ نصب و راه‌اندازی

### 1. نصب وابستگی‌های سرور

```bash
# نصب Node.js (اگر نصب نیست)
# از سایت nodejs.org دانلود کنید

# نصب وابستگی‌ها
npm install

# یا
npm run install-deps
```

### 2. راه‌اندازی سرور

```bash
# شروع سرور
npm start

# یا برای حالت توسعه
npm run dev
```

سرور روی `http://localhost:3000` اجرا می‌شود.

### 3. تنظیم کد آردوینو

1. فایل `GPS_Tracker_HTTP.ino` را در Arduino IDE باز کنید
2. تنظیمات زیر را تغییر دهید:

```cpp
// تنظیمات شبکه
const String APN = "internet"; // APN اپراتور شما
const String SERVER_URL = "http://your-server.com"; // آدرس سرور
const String DEVICE_ID = "GPS001"; // شناسه یکتا
```

3. کد را روی آردوینو آپلود کنید

### 4. اتصالات سخت‌افزاری

```
GPS NEO-6M        Arduino UNO
VCC       -------- 5V
GND       -------- GND
TX        -------- Pin 8 (RX نرم‌افزاری)
RX        -------- Pin 9 (TX نرم‌افزاری)

SIM800L           Arduino UNO
VCC       -------- 4.2V (یا منبع جداگانه)
GND       -------- GND
TX        -------- Pin 11 (RX نرم‌افزاری)
RX        -------- Pin 10 (TX نرم‌افزاری)
```

## 📱 نحوه استفاده

### 1. راه‌اندازی اولیه
1. سرور را اجرا کنید
2. آردوینو را روشن کنید
3. منتظر اتصال GPS و اینترنت باشید
4. مرورگر را باز کنید و به `http://localhost:3000` بروید

### 2. شروع ردیابی
- سیستم به صورت خودکار شروع به ارسال موقعیت می‌کند
- موقعیت‌ها روی نقشه نمایش داده می‌شوند
- مسیر حرکت به صورت خط آبی نمایش داده می‌شود

### 3. کنترل سیستم
- **انتخاب دستگاه**: از منوی کشویی دستگاه مورد نظر را انتخاب کنید
- **بازه زمانی**: مدت زمان نمایش مسیر را انتخاب کنید
- **به‌روزرسانی**: برای به‌روزرسانی دستی داده‌ها کلیک کنید
- **پاک کردن مسیر**: برای پاک کردن مسیر فعلی کلیک کنید

## 🔧 تنظیمات پیشرفته

### تغییر فاصله ارسال موقعیت
در فایل آردوینو:
```cpp
const unsigned long SEND_INTERVAL = 30000; // 30 ثانیه
```

### تغییر شعاع هشدار
```cpp
const double RADIUS_METERS = 100.0; // 100 متر
```

### تنظیم APN اپراتورهای مختلف
```cpp
// ایرانسل
const String APN = "mcinet";

// همراه اول
const String APN = "internet";

// رایتل
const String APN = "internet";
```

## 📊 API Endpoints

### دریافت آخرین موقعیت
```
GET /api/location/:device_id
```

### دریافت مسیر حرکت
```
GET /api/track/:device_id?hours=24
```

### دریافت لیست دستگاه‌ها
```
GET /api/devices
```

### دریافت آمار
```
GET /api/stats/:device_id?hours=24
```

## 🗄️ دیتابیس

سیستم از SQLite استفاده می‌کند و جداول زیر را ایجاد می‌کند:

- **locations**: ذخیره موقعیت‌ها
- **alerts**: ذخیره هشدارها
- **devices**: اطلاعات دستگاه‌ها

## 🔍 عیب‌یابی

### مشکلات رایج

1. **عدم اتصال به اینترنت**
   - APN را بررسی کنید
   - اعتبار سیم‌کارت را چک کنید
   - سیگنال شبکه را بررسی کنید

2. **عدم دریافت موقعیت GPS**
   - GPS را در فضای باز قرار دهید
   - اتصالات را بررسی کنید
   - چند دقیقه صبر کنید

3. **عدم نمایش روی نقشه**
   - اتصال سرور را بررسی کنید
   - Console مرورگر را چک کنید
   - API endpoints را تست کنید

### بررسی لاگ‌ها

```bash
# لاگ‌های سرور
npm start

# لاگ‌های آردوینو
Serial Monitor در Arduino IDE
```

## 📈 بهینه‌سازی عملکرد

### کاهش مصرف باتری
- افزایش فاصله ارسال موقعیت
- استفاده از Sleep mode
- بهینه‌سازی کد

### بهبود دقت
- استفاده از آنتن GPS خارجی
- فیلتر کردن نقاط نامعتبر
- میانگین‌گیری از چندین خواندن

## 🔒 امنیت

- استفاده از HTTPS در تولید
- احراز هویت دستگاه‌ها
- رمزگذاری داده‌های حساس
- محدود کردن دسترسی API

## 📝 نکات مهم

1. **مصرف اینترنت**: هر موقعیت حدود 200 بایت مصرف می‌کند
2. **دقت GPS**: معمولاً 3-5 متر در فضای باز
3. **پوشش شبکه**: در مناطق با پوشش ضعیف ممکن است قطع شود
4. **ذخیره‌سازی**: دیتابیس به مرور زمان بزرگ می‌شود

## 🆘 پشتیبانی

برای سوالات و مشکلات:
1. لاگ‌های سیستم را بررسی کنید
2. Console مرورگر را چک کنید
3. اتصالات سخت‌افزاری را بررسی کنید
4. تنظیمات شبکه را چک کنید

---

**نکته**: این سیستم برای اهداف آموزشی و شخصی طراحی شده است. در استفاده تجاری، قوانین محلی و امنیتی را در نظر بگیرید.
